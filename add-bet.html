<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add New Bet - Parlay Tracker</title>
  <link rel="stylesheet" href="media/style.css">
  <style>
    :root {
      --bg: #121212;
      --surface: #252525;
      --primary: #140d52;
      --text: #e0e0e0;
      --text-secondary: #aaa;
      --border: #ffcc00a4;
      --green: #4caf50;
      --error: #f44336;
      --section-bg: #1a1a1a;
      --title-color: #e657ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      min-height: 100vh;
      padding: 15px;
      color: var(--text);
    }

    .form-container {
      max-width: 700px;
      margin: 0 auto;
      background: var(--surface);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }

    .form-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--primary);
    }

    .form-header h1 {
      color: var(--title-color);
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    .form-header p {
      color: var(--text-secondary);
      font-size: 0.85em;
    }

    .form-section {
      margin-bottom: 20px;
      padding: 15px;
      background: var(--section-bg);
      border-radius: 8px;
      border: 1px solid rgba(255, 204, 0, 0.2);
    }

    .form-section h2 {
      color: var(--title-color);
      font-size: 1.1em;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 6px;
      font-size: 0.9em;
    }

    .form-group label .required {
      color: var(--error);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid rgba(255, 204, 0, 0.3);
      border-radius: 6px;
      font-size: 0.95em;
      transition: border-color 0.3s, background-color 0.3s;
      box-sizing: border-box;
      background: var(--bg);
      color: var(--text);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--title-color);
      background: var(--surface);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .leg-card {
      background: var(--surface);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 1px solid rgba(255, 204, 0, 0.3);
      position: relative;
    }

    .leg-card h3 {
      color: var(--title-color);
      font-size: 1em;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
    }

    .remove-leg-btn {
      background: var(--error);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.8em;
      transition: opacity 0.3s, transform 0.1s;
    }

    .remove-leg-btn:hover {
      opacity: 0.9;
      transform: scale(1.05);
    }

    .remove-leg-btn:active {
      transform: scale(0.95);
    }

    .add-leg-btn,
    .submit-btn,
    .cancel-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 0.95em;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.3s, transform 0.1s, box-shadow 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .add-leg-btn {
      background: var(--primary);
      color: white;
      width: 100%;
      justify-content: center;
    }

    .add-leg-btn:hover {
      opacity: 0.9;
      box-shadow: 0 4px 12px rgba(20, 13, 82, 0.4);
    }

    .add-leg-btn:active {
      transform: scale(0.98);
    }

    .submit-btn {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      width: 100%;
      justify-content: center;
      margin-top: 15px;
    }

    .submit-btn:hover {
      opacity: 0.9;
      box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
    }

    .submit-btn:active {
      transform: scale(0.98);
    }

    .cancel-btn {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      width: 100%;
      justify-content: center;
      margin-top: 8px;
      border: 1px solid rgba(255, 204, 0, 0.3);
    }

    .cancel-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .cancel-btn:active {
      transform: scale(0.98);
    }

    .help-text {
      font-size: 0.8em;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .stat-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .stat-type-option {
      padding: 8px;
      background: var(--bg);
      border: 1px solid rgba(255, 204, 0, 0.3);
      border-radius: 6px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
      font-size: 0.9em;
      color: var(--text);
    }

    .stat-type-option:hover {
      border-color: var(--title-color);
      background: var(--surface);
    }

    .stat-type-option.selected {
      border-color: var(--title-color);
      background: var(--title-color);
      color: white;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      font-size: 0.9em;
    }

    .notification.success {
      background: var(--green);
    }

    .notification.error {
      background: var(--error);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }

      .form-container {
        padding: 15px;
      }

      .form-header h1 {
        font-size: 1.3em;
      }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <div class="form-header">
      <h1>Add New Bet</h1>
      <p>Create a new parlay or single bet to track</p>
    </div>

    <form id="add-bet-form">
      <!-- Bet Information Section -->
      <div class="form-section">
        <h2>Bet Information</h2>
        
        <div class="form-group">
          <label for="bet-name">Bet Name <span class="required">*</span></label>
          <input type="text" id="bet-name" placeholder="e.g., Sunday Night Special" required>
          <div class="help-text">Give your bet a memorable name</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="bet-type">Bet Type <span class="required">*</span></label>
            <select id="bet-type" required>
              <option value="">Select type...</option>
              <option value="parlay">Parlay</option>
              <option value="SGP">Same Game Parlay (SGP)</option>
              <option value="single">Single Bet</option>
              <option value="teaser">Teaser</option>
            </select>
          </div>

          <div class="form-group">
            <label for="betting-site">Betting Site <span class="required">*</span></label>
            <select id="betting-site" required>
              <option value="">Select site...</option>
              <option value="FanDuel">FanDuel</option>
              <option value="DraftKings">DraftKings</option>
              <option value="BetMGM">BetMGM</option>
              <option value="Caesars">Caesars</option>
              <option value="PointsBet">PointsBet</option>
              <option value="Dabble">Dabble</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="wager">Wager Amount <span class="required">*</span></label>
            <input type="number" id="wager" placeholder="25.00" step="0.01" min="0" required>
          </div>

          <div class="form-group">
            <label for="odds">Odds <span class="required">*</span></label>
            <input type="text" id="odds" placeholder="+250 or -110" required>
            <div class="help-text">Format: +250 or -110</div>
          </div>
        </div>

        <div class="form-group">
          <label for="bet-id">Bet ID (Optional)</label>
          <input type="text" id="bet-id" placeholder="From betting slip">
          <div class="help-text">Optional: Copy from your betting site</div>
        </div>
      </div>

      <!-- Legs Section -->
      <div class="form-section">
        <h2>Bet Legs</h2>
        <div id="legs-container"></div>
        <button type="button" class="add-leg-btn" id="add-leg-btn">
          + Add Leg
        </button>
      </div>

      <!-- Submit Section -->
      <button type="submit" class="submit-btn">
        Create Bet
      </button>
      <button type="button" class="cancel-btn" onclick="window.location.href='/'">
        Cancel
      </button>
    </form>
  </div>

  <script>
    let legCount = 0;

    // Sports and their common stats
    const sportStats = {
      'NFL': {
        'Player Props': [
          { value: 'passing_yards_alt', label: 'Passing Yards' },
          { value: 'rushing_yards_alt', label: 'Rushing Yards' },
          { value: 'receiving_yards_alt', label: 'Receiving Yards' },
          { value: 'touchdowns', label: 'Total Touchdowns' },
          { value: 'receptions', label: 'Receptions' },
          { value: 'pass_completions', label: 'Pass Completions' },
          { value: 'pass_attempts', label: 'Pass Attempts' },
          { value: 'interceptions', label: 'Interceptions' },
        ],
        'Team Props': [
          { value: 'spread', label: 'Spread' },
          { value: 'moneyline', label: 'Moneyline' },
          { value: 'total_points', label: 'Total Points O/U' },
        ]
      },
      'NBA': {
        'Player Props': [
          { value: 'points', label: 'Points' },
          { value: 'rebounds', label: 'Rebounds' },
          { value: 'assists', label: 'Assists' },
          { value: 'threes', label: '3-Pointers Made' },
          { value: 'steals', label: 'Steals' },
          { value: 'blocks', label: 'Blocks' },
          { value: 'pts_rebs_asts', label: 'PTS+REB+AST' },
        ],
        'Team Props': [
          { value: 'spread', label: 'Spread' },
          { value: 'moneyline', label: 'Moneyline' },
          { value: 'total_points', label: 'Total Points O/U' },
        ]
      },
      'MLB': {
        'Player Props': [
          { value: 'hits', label: 'Hits' },
          { value: 'runs', label: 'Runs' },
          { value: 'rbis', label: 'RBIs' },
          { value: 'strikeouts_pitcher', label: 'Strikeouts (Pitcher)' },
          { value: 'home_runs', label: 'Home Runs' },
        ],
        'Team Props': [
          { value: 'spread', label: 'Run Line' },
          { value: 'moneyline', label: 'Moneyline' },
          { value: 'total_runs', label: 'Total Runs O/U' },
        ]
      },
      'NHL': {
        'Player Props': [
          { value: 'goals', label: 'Goals' },
          { value: 'assists', label: 'Assists' },
          { value: 'points', label: 'Points' },
          { value: 'saves', label: 'Saves (Goalie)' },
          { value: 'shots', label: 'Shots on Goal' },
        ],
        'Team Props': [
          { value: 'spread', label: 'Puck Line' },
          { value: 'moneyline', label: 'Moneyline' },
          { value: 'total_goals', label: 'Total Goals O/U' },
        ]
      }
    };

    function addLeg() {
      legCount++;
      const legCard = document.createElement('div');
      legCard.className = 'leg-card';
      legCard.id = `leg-${legCount}`;
      
      legCard.innerHTML = `
        <h3>
          Leg ${legCount}
          <button type="button" class="remove-leg-btn" onclick="removeLeg(${legCount})">Remove</button>
        </h3>
        
        <div class="form-group">
          <label>Sport <span class="required">*</span></label>
          <select class="leg-sport" onchange="updateStatOptions(${legCount})" required>
            <option value="">Select sport...</option>
            <option value="NFL">NFL</option>
            <option value="NBA">NBA</option>
            <option value="MLB">MLB</option>
            <option value="NHL">NHL</option>
          </select>
        </div>

        <div class="form-group">
          <label>Bet Category <span class="required">*</span></label>
          <select class="leg-category" onchange="updateStatOptions(${legCount})" required>
            <option value="">Select category...</option>
            <option value="Player Props">Player Props</option>
            <option value="Team Props">Team Props</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Game Date <span class="required">*</span></label>
            <input type="date" class="leg-date" required>
          </div>

          <div class="form-group leg-player-group">
            <label class="leg-player-label">Player/Team Name <span class="required">*</span></label>
            <input type="text" class="leg-player" placeholder="e.g., Patrick Mahomes" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Away Team <span class="required">*</span></label>
            <input type="text" class="leg-away" placeholder="e.g., Kansas City Chiefs" required>
          </div>

          <div class="form-group">
            <label>Home Team <span class="required">*</span></label>
            <input type="text" class="leg-home" placeholder="e.g., Tampa Bay Buccaneers" required>
          </div>
        </div>

        <div class="form-group">
          <label>Stat Type <span class="required">*</span></label>
          <select class="leg-stat" required>
            <option value="">Select stat...</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Over/Under <span class="required">*</span></label>
            <select class="leg-stat-add" required>
              <option value="over">Over</option>
              <option value="under">Under</option>
            </select>
          </div>

          <div class="form-group">
            <label>Target <span class="required">*</span></label>
            <input type="number" class="leg-target" placeholder="275.5" step="0.5" required>
          </div>
        </div>
      `;
      
      document.getElementById('legs-container').appendChild(legCard);
      
      // Set today's date as default
      const today = new Date().toISOString().split('T')[0];
      legCard.querySelector('.leg-date').value = today;
    }

    function removeLeg(legId) {
      const leg = document.getElementById(`leg-${legId}`);
      if (leg) {
        leg.remove();
      }
    }

    function updateStatOptions(legId) {
      const legCard = document.getElementById(`leg-${legId}`);
      const sport = legCard.querySelector('.leg-sport').value;
      const category = legCard.querySelector('.leg-category').value;
      const statSelect = legCard.querySelector('.leg-stat');
      const playerLabel = legCard.querySelector('.leg-player-label');
      const playerInput = legCard.querySelector('.leg-player');
      
      // Update label based on category
      if (category === 'Team Props') {
        playerLabel.textContent = 'Team Name ';
        playerInput.placeholder = 'e.g., Kansas City Chiefs';
      } else {
        playerLabel.textContent = 'Player Name ';
        playerInput.placeholder = 'e.g., Patrick Mahomes';
      }
      playerLabel.innerHTML += '<span class="required">*</span>';
      
      // Clear and populate stat options
      statSelect.innerHTML = '<option value="">Select stat...</option>';
      
      if (sport && category && sportStats[sport] && sportStats[sport][category]) {
        sportStats[sport][category].forEach(stat => {
          const option = document.createElement('option');
          option.value = stat.value;
          option.textContent = stat.label;
          statSelect.appendChild(option);
        });
      }
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    async function submitBet(event) {
      event.preventDefault();
      
      // Collect bet data
      const betData = {
        name: document.getElementById('bet-name').value,
        type: document.getElementById('bet-type').value,
        betting_site: document.getElementById('betting-site').value,
        wager: parseFloat(document.getElementById('wager').value),
        odds: document.getElementById('odds').value,
        bet_id: document.getElementById('bet-id').value || null,
        sport: '', // Will be set from first leg
        legs: []
      };

      // Collect legs
      const legCards = document.querySelectorAll('.leg-card');
      if (legCards.length === 0) {
        showNotification('Please add at least one leg to your bet', 'error');
        return;
      }

      legCards.forEach((legCard, index) => {
        const sport = legCard.querySelector('.leg-sport').value;
        if (index === 0) {
          betData.sport = sport;
        }
        
        const leg = {
          game_date: legCard.querySelector('.leg-date').value,
          away: legCard.querySelector('.leg-away').value,
          home: legCard.querySelector('.leg-home').value,
          player: legCard.querySelector('.leg-player').value,
          stat: legCard.querySelector('.leg-stat').value,
          stat_add: legCard.querySelector('.leg-stat-add').value,
          target: parseFloat(legCard.querySelector('.leg-target').value),
          sport: sport
        };
        
        betData.legs.push(leg);
      });

      // Calculate bet date (earliest game date)
      const dates = betData.legs.map(leg => leg.game_date);
      betData.bet_date = dates.sort()[0];

      try {
        const response = await fetch('/api/bets', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify(betData)
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Failed to create bet');
        }

        const result = await response.json();
        showNotification('Bet created successfully! Redirecting...', 'success');
        
        setTimeout(() => {
          window.location.href = '/';
        }, 1500);
        
      } catch (error) {
        console.error('Error creating bet:', error);
        showNotification(error.message, 'error');
      }
    }

    // Initialize
    document.getElementById('add-leg-btn').addEventListener('click', addLeg);
    document.getElementById('add-bet-form').addEventListener('submit', submitBet);
    
    // Add first leg by default
    addLeg();
  </script>
</body>
</html>
